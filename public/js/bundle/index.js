var e=require("node-fetch");function t(e){return e&&e.__esModule?e.default:e}const a=()=>{const e=document.querySelector(".alert");e&&e.parentElement.removeChild(e)},o=(e,t)=>{a();const o=`<div class="alert alert--${e}">${t}</div>`;document.querySelector("body").insertAdjacentHTML("afterbegin",o),window.setTimeout(a,5e3)},n=async(a,n)=>{const s=await t(e)("/api/v1/users/login",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:a,password:n})}),d=await s.json();"success"===d.status?(o("success","You are now logged in"),setTimeout((()=>{location.assign("/")}),1e3)):o("error",d.message)},s=async(a,n,s,d)=>{const r=await t(e)("/api/v1/users/signup",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({name:a,email:n,password:s,passwordConfirm:d})}),c=await r.json();"success"===c.status?(o("success","You now have an account"),setTimeout((()=>{location.assign("/")}),1e3)):o("error",c.message)},d=e=>{mapboxgl.accessToken="pk.eyJ1IjoiamRlZWphdCIsImEiOiJjbDdkN3J5bncwazhvM3ZvbDJ3Mjl3dGh2In0.MqeSMRvJZuR5gu7Ndwww-A";const t=new mapboxgl.Map({container:"map",style:"mapbox://styles/jdeejat/cj20he7w700402rmjs5zfkwlj",cooperativeGestures:!0});t.on("style.load",(()=>{t.setFog({})})),t.addControl(new mapboxgl.FullscreenControl);const a=new mapboxgl.LngLatBounds;e.forEach((e=>{const o=document.createElement("div");o.className="marker",new mapboxgl.Marker({element:o,anchor:"bottom"}).setLngLat(e.coordinates).setPopup(new mapboxgl.Popup({offset:25}).setHTML(`<a href='${e.googleMapsLink}' target="_blank">${e.pointName}</a>`)).addTo(t),a.extend(e.coordinates)})),t.fitBounds(a,{padding:{top:200,bottom:150,left:100,right:100}})},r=async(a,n)=>{const s=await t(e)("/api/v1/users/updateMe",{method:"PATCH",body:a}),d=await s.json();"success"===d.status?o("success","Data updated"):o("error",d.message)},c=async(a,n,s)=>{const d=await t(e)("/api/v1/users/updatePassword",{method:"PATCH",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({currentPassword:a,newPassword:n,newPasswordConfirm:s})}),r=await d.json();"success"===r.status?o("success","Password updated"):o("error",r.message)},u=async(a=0,o=12)=>{const n=await t(e)(`/?limit=${o}&page=${a}`,{method:"GET"});return await n.text()},i=document.getElementById("map"),l=document.querySelector(".form--login"),m=document.querySelector(".form--signup"),p=document.querySelector(".nav__el--logout"),g=document.querySelector(".form-user-data"),w=document.querySelector(".form-user-password"),y=document.getElementById("load-more");if(i){d(JSON.parse(i.dataset.locations))}l&&l.addEventListener("submit",(e=>{e.preventDefault();const t=document.getElementById("email").value,a=document.getElementById("password").value;n(t,a)})),m&&m.addEventListener("submit",(e=>{e.preventDefault();const t=document.getElementById("name").value,a=document.getElementById("email").value,o=document.getElementById("password").value,n=document.getElementById("passwordConfirm").value;s(t,a,o,n)})),p&&p.addEventListener("click",(async()=>{const a=await t(e)("/api/v1/users/logout",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});"success"===(await a.json()).status?(o("success","You are now logged out"),setTimeout((()=>{location.reload(!0)}),2e3)):o("error","Something went wrong. Try again!")})),g&&g.addEventListener("submit",(e=>{e.preventDefault();const t=new FormData;t.append("name",document.getElementById("name").value),t.append("email",document.getElementById("email").value),t.append("photo",document.getElementById("photo").files[0]),r(t)})),w&&w.addEventListener("submit",(async e=>{e.preventDefault(),document.querySelector(".btn--save-password").textContent="Updating...";const t=document.getElementById("password-current").value,a=document.getElementById("password").value,o=document.getElementById("password-confirm").value;await c(t,a,o),document.querySelector(".btn--save-password").textContent="Save password",document.getElementById("password-current").value="",document.getElementById("password").value="",document.getElementById("password-confirm").value=""})),y&&y.addEventListener("click",(async()=>{const e=1*y.dataset.page+1,t=await u(e);document.querySelector(".card-container").insertAdjacentHTML("beforeend",t),y.dataset.page=e}));
//# sourceMappingURL=index.js.map
